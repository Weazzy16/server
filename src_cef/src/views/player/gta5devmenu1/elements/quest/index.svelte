<script>
    import { translateText } from 'lang'
    import './main.sass';
    import './fonts/style.css';
    import KeyAnimation from '@/components/keyAnimation/index.svelte';
    import { getQuest , getActors } from 'json/quests/quests.js';
    import { format } from 'api/formatter'
    import { storeQuests, selectQuest } from 'store/quest'
    import { executeClient } from 'api/rage'
    export let visible;

    let QuestsList = [];
    let OldQuest = [];

    let quest = false;
    const onSelectQuest = (actorName) => {

        const listIndex = QuestsList.findIndex(q => q.ActorName == actorName);
        if (QuestsList [listIndex]) {
            window.questStore.selectQuest (actorName);
            executeClient ("client.quest.selectQuest", actorName);
            return;
        }
        quest = false;
    }


    storeQuests.subscribe((value) => {        
        if (value && value && value.length && OldQuest != value) {
            executeClient ("client.quest.selectQuest.Clear");

            OldQuest = value;
            QuestsList = [];

            value.forEach(questData => {
                const questInfo = getQuest(questData.ActorName, questData.Line);
                
                if (questInfo && questInfo.Title && questInfo.Desc && questInfo.Tasks && questInfo.Tasks [questData.Stage]) {

                    QuestsList.push ({
                        ActorName: questData.ActorName,
                        Title: questInfo.Title,
                        Desc: questInfo.Desc,
                        Tasks: questInfo.Tasks,
                        Reward: questInfo.Reward,
                        Stage: questData.Stage
                    });
                }
            });
            QuestsList = QuestsList;
            if (!quest && typeof $selectQuest === "string") {
                const listIndex = QuestsList.findIndex(q => q.ActorName == $selectQuest);
                if (QuestsList [listIndex]) {
                    quest = QuestsList [listIndex];
                    return;
                }
            }

        }
    });

    const handleArrowKeys = (events) => {
        if (!quest || !quest.ActorName)
            return;
        else if (!visible)
            return;
        const { keyCode } = events;
        if (keyCode === 13) {
            onRoute ();
        }
        if (keyCode === 90) {
            onSelect ();
        }
    }

    const onRoute = () => {
        if (!quest)
            return;

        executeClient ("client.quest.router", quest.ActorName);
    }

    const onSelect = (actorName) => {
        if (!quest)
            return;

        onSelectQuest (quest.ActorName);
        window.notificationAdd(2, 9, translateText('player1', 'Вы сменили закрепленный квест.'), 3000);
    }
</script>

<svelte:window on:keyup={handleArrowKeys} />

{#if QuestsList && QuestsList.length}
    <div class="questmenu">
        <div class="questleft">
            {#each QuestsList as questData, index}
                <div class="questblock" class:active={questData == quest} on:keypress={() => {}} on:click={() => quest = questData}>
                    <img src="http://gta5dev.online/heone/f2menu/{questData.ActorName}.png" alt=""/>
                    <div class="questinfo">
                        <h1>{questData.Title}</h1>
                        <p>{getActors (questData.ActorName).name}<b>-  Квестовое задание</b></p>
                    </div>
                </div>
            {/each}
        </div>
        <div class="questright">
            <div class="questhead">
                <div class="questlefth">
                    <img src="http://gta5dev.online/heone/f2menu/{quest.ActorName}.png" alt=""/>
                    <div class="questinfo">
                        <h1>{quest.Title}</h1>
                        <p>{getActors (quest.ActorName).name}<b>-  Квестовое задание</b></p>
                    </div>
                </div>
                {#if quest.Reward}
                    <div class="questrighth">
                        <p>Награда:<b>
                            {#if quest.Reward && quest.Reward.Exp}
                                <span>
                                    {quest.Reward.Exp}
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <g clip-path="url(#clip0_661_597)">
                                        <path d="M14.1476 4.93541L9.96824 4.54778L8.30805 0.692687C8.1918 0.42275 7.80908 0.42275 7.69287 0.692687L6.03268 4.54775L1.85327 4.93541C1.56062 4.96253 1.44237 5.32653 1.66315 5.5205L4.81652 8.29069L3.89368 12.3853C3.82905 12.6721 4.13871 12.897 4.3914 12.747L8.00046 10.604L11.6095 12.747C11.8622 12.897 12.1718 12.6721 12.1072 12.3853L11.1844 8.29069L14.3378 5.5205C14.5586 5.32653 14.4403 4.96253 14.1476 4.93541Z" fill="#FFDC64"/>
                                        <path d="M3.72742 0.560012C3.94049 0.85595 4.54186 2.12689 4.88567 2.86757C4.93974 2.98401 4.79364 3.0892 4.70036 3.00098C4.10702 2.43998 3.09249 1.46648 2.87942 1.17051C2.71083 0.936356 2.76399 0.609856 2.99817 0.441262C3.23233 0.272669 3.55883 0.325856 3.72742 0.560012ZM12.2725 0.560012C12.0595 0.85595 11.4581 2.12689 11.1143 2.86757C11.0602 2.98401 11.2063 3.0892 11.2996 3.00098C11.893 2.43998 12.9075 1.46645 13.1205 1.17051C13.2891 0.936356 13.236 0.609856 13.0018 0.441262C12.7676 0.272669 12.4411 0.325856 12.2725 0.560012ZM15.6394 9.23833C15.2927 9.12526 13.8991 8.93848 13.089 8.83598C12.9617 8.81986 12.9059 8.99101 13.0182 9.05307C13.733 9.44792 14.9687 10.1187 15.3154 10.2317C15.5897 10.3212 15.8846 10.1714 15.9741 9.89701C16.0635 9.62267 15.9137 9.32779 15.6394 9.23833ZM0.36058 9.23833C0.707267 9.12526 2.10086 8.93848 2.91095 8.83598C3.0383 8.81986 3.09411 8.99101 2.98177 9.05307C2.26699 9.44792 1.03127 10.1187 0.68458 10.2317C0.410267 10.3212 0.115361 10.1714 0.0258921 9.89701C-0.0635767 9.62267 0.0862671 9.32779 0.36058 9.23833ZM7.49355 15.1346C7.49355 14.7699 7.74808 13.3871 7.90183 12.5852C7.92599 12.4591 8.10602 12.4591 8.13017 12.5852C8.28392 13.3871 8.53845 14.7699 8.53845 15.1346C8.53845 15.4231 8.30455 15.657 8.01602 15.657C7.72745 15.6571 7.49355 15.4231 7.49355 15.1346Z" fill="#FFF082"/>
                                        <path d="M8.91174 2.09456L8.30802 0.692687C8.19177 0.42275 7.80905 0.42275 7.69284 0.692687L6.03265 4.54775L1.85327 4.93541C1.56062 4.96253 1.44237 5.32653 1.66315 5.5205L4.81652 8.29069L3.89368 12.3853C3.82905 12.6721 4.13871 12.897 4.3914 12.747L4.87174 12.4618C5.65921 7.36425 7.87302 3.62231 8.91174 2.09456Z" fill="#FFC850"/>
                                        </g>
                                        <defs>
                                        <clipPath id="clip0_661_597">
                                        <rect width="16" height="16" fill="white"/>
                                        </clipPath>
                                        </defs>
                                    </svg>
                                </span>
                                {:else}
                                <span>
                                    0
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <g clip-path="url(#clip0_661_597)">
                                        <path d="M14.1476 4.93541L9.96824 4.54778L8.30805 0.692687C8.1918 0.42275 7.80908 0.42275 7.69287 0.692687L6.03268 4.54775L1.85327 4.93541C1.56062 4.96253 1.44237 5.32653 1.66315 5.5205L4.81652 8.29069L3.89368 12.3853C3.82905 12.6721 4.13871 12.897 4.3914 12.747L8.00046 10.604L11.6095 12.747C11.8622 12.897 12.1718 12.6721 12.1072 12.3853L11.1844 8.29069L14.3378 5.5205C14.5586 5.32653 14.4403 4.96253 14.1476 4.93541Z" fill="#FFDC64"/>
                                        <path d="M3.72742 0.560012C3.94049 0.85595 4.54186 2.12689 4.88567 2.86757C4.93974 2.98401 4.79364 3.0892 4.70036 3.00098C4.10702 2.43998 3.09249 1.46648 2.87942 1.17051C2.71083 0.936356 2.76399 0.609856 2.99817 0.441262C3.23233 0.272669 3.55883 0.325856 3.72742 0.560012ZM12.2725 0.560012C12.0595 0.85595 11.4581 2.12689 11.1143 2.86757C11.0602 2.98401 11.2063 3.0892 11.2996 3.00098C11.893 2.43998 12.9075 1.46645 13.1205 1.17051C13.2891 0.936356 13.236 0.609856 13.0018 0.441262C12.7676 0.272669 12.4411 0.325856 12.2725 0.560012ZM15.6394 9.23833C15.2927 9.12526 13.8991 8.93848 13.089 8.83598C12.9617 8.81986 12.9059 8.99101 13.0182 9.05307C13.733 9.44792 14.9687 10.1187 15.3154 10.2317C15.5897 10.3212 15.8846 10.1714 15.9741 9.89701C16.0635 9.62267 15.9137 9.32779 15.6394 9.23833ZM0.36058 9.23833C0.707267 9.12526 2.10086 8.93848 2.91095 8.83598C3.0383 8.81986 3.09411 8.99101 2.98177 9.05307C2.26699 9.44792 1.03127 10.1187 0.68458 10.2317C0.410267 10.3212 0.115361 10.1714 0.0258921 9.89701C-0.0635767 9.62267 0.0862671 9.32779 0.36058 9.23833ZM7.49355 15.1346C7.49355 14.7699 7.74808 13.3871 7.90183 12.5852C7.92599 12.4591 8.10602 12.4591 8.13017 12.5852C8.28392 13.3871 8.53845 14.7699 8.53845 15.1346C8.53845 15.4231 8.30455 15.657 8.01602 15.657C7.72745 15.6571 7.49355 15.4231 7.49355 15.1346Z" fill="#FFF082"/>
                                        <path d="M8.91174 2.09456L8.30802 0.692687C8.19177 0.42275 7.80905 0.42275 7.69284 0.692687L6.03265 4.54775L1.85327 4.93541C1.56062 4.96253 1.44237 5.32653 1.66315 5.5205L4.81652 8.29069L3.89368 12.3853C3.82905 12.6721 4.13871 12.897 4.3914 12.747L4.87174 12.4618C5.65921 7.36425 7.87302 3.62231 8.91174 2.09456Z" fill="#FFC850"/>
                                        </g>
                                        <defs>
                                        <clipPath id="clip0_661_597">
                                        <rect width="16" height="16" fill="white"/>
                                        </clipPath>
                                        </defs>
                                    </svg>
                                </span>
                            {/if}
                            {#if quest.Reward && quest.Reward.Money}
                                <span>
                                    {format("money", quest.Reward.Money)}
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <g clip-path="url(#clip0_661_604)">
                                        <path d="M6.85405 15.4348L1.80848 11.496C1.56935 11.3093 1.5274 10.9641 1.71476 10.7252L9.9622 0.210653C10.1493 -0.0278984 10.4944 -0.0701358 10.7331 0.116263L15.7787 4.05513C16.0179 4.24178 16.0598 4.58699 15.8724 4.8259L7.62501 15.3404C7.43787 15.579 7.09286 15.6212 6.85405 15.4348Z" fill="#57AD7B"/>
                                        <path d="M3.66743 15.7569L0.102847 10.4452C-0.0661668 10.1934 0.00137441 9.85213 0.25364 9.68321L11.3646 2.24437C11.6166 2.07568 11.9575 2.1428 12.1263 2.39436L15.6909 7.70601C15.8599 7.95785 15.7924 8.2991 15.5401 8.46802L4.42916 15.9069C4.17718 16.0756 3.83626 16.0084 3.66743 15.7569Z" fill="#81CDA1"/>
                                        <path d="M15.6913 7.70601L12.1267 2.39436C11.9579 2.1428 11.617 2.07568 11.365 2.24437L10.9326 2.53385L14.4036 7.70601C14.5726 7.95785 14.5051 8.2991 14.2528 8.46802L3.57422 15.6174L3.66784 15.7569C3.83666 16.0084 4.17758 16.0756 4.42956 15.9069L15.5405 8.46802C15.7928 8.2991 15.8603 7.95785 15.6913 7.70601Z" fill="#60BF88"/>
                                        <path d="M10.8241 9.25356C10.918 7.63959 9.68426 6.255 8.06847 6.16098C6.45267 6.06697 5.06668 7.29913 4.97277 8.9131C4.87886 10.5271 6.1126 11.9117 7.72839 12.0057C9.34419 12.0997 10.7302 10.8675 10.8241 9.25356Z" fill="#29795D"/>
                                        <path d="M1.77438 8.66541C2.50649 9.75634 2.21469 11.2335 1.12263 11.9646L0.102624 10.4447C-0.0661647 10.1932 0.0015375 9.85234 0.253867 9.68342L1.77438 8.66541ZM2.65045 14.2413C3.74483 13.5086 5.22427 13.7971 5.95482 14.8857L4.43009 15.9066C4.17779 16.0755 3.83642 16.0085 3.66763 15.757L2.65045 14.2413ZM14.0206 9.48721C13.2885 8.39628 13.5803 6.91916 14.6723 6.18802L15.6923 7.70792C15.8611 7.95945 15.7934 8.30028 15.5411 8.46919L14.0206 9.48721ZM13.1445 3.91135C12.0501 4.64407 10.5707 4.35552 9.84012 3.26688L11.3649 2.24606C11.6172 2.07714 11.9585 2.14411 12.1273 2.3956L13.1445 3.91135Z" fill="#29795D"/>
                                        <path d="M11.574 6.85551C11.5222 6.85557 11.4717 6.83897 11.4301 6.80814C11.3884 6.77732 11.3578 6.73392 11.3427 6.68435C11.3276 6.63478 11.3289 6.58167 11.3463 6.53287C11.3638 6.48407 11.3964 6.44217 11.4395 6.41337L12.5761 5.65239C12.6025 5.63475 12.632 5.62247 12.6631 5.61625C12.6942 5.61004 12.7262 5.61001 12.7573 5.61617C12.7885 5.62233 12.818 5.63455 12.8444 5.65215C12.8708 5.66974 12.8935 5.69235 12.9111 5.7187C12.9287 5.74505 12.941 5.77462 12.9472 5.80571C12.9534 5.8368 12.9535 5.86882 12.9473 5.89992C12.9412 5.93103 12.9289 5.96062 12.9113 5.987C12.8937 6.01338 12.8711 6.03603 12.8448 6.05367L11.7081 6.81465C11.6685 6.8413 11.6218 6.85552 11.574 6.85551ZM3.08349 12.54C3.03169 12.54 2.98124 12.5234 2.9396 12.4926C2.89796 12.4618 2.86734 12.4184 2.85226 12.3688C2.83717 12.3193 2.83843 12.2662 2.85585 12.2174C2.87326 12.1686 2.9059 12.1267 2.94896 12.0979L4.08557 11.3369C4.13878 11.3018 4.20373 11.2891 4.26624 11.3017C4.32875 11.3143 4.38374 11.3511 4.41921 11.4041C4.45469 11.4571 4.46776 11.5219 4.45559 11.5845C4.44341 11.6471 4.40697 11.7023 4.35422 11.7381L3.21761 12.4991C3.17796 12.5258 3.13127 12.54 3.08349 12.54Z" fill="#29795D"/>
                                        <path d="M9.02474 10.3591C9.37288 10.0003 9.38421 9.50388 9.22582 9.15278C9.01894 8.69435 8.56299 8.48078 8.06406 8.60878C8.00406 8.62417 7.94253 8.63949 7.88059 8.65407L7.33283 7.83785C7.47042 7.79316 7.57766 7.80482 7.58825 7.8061C7.65121 7.81523 7.71523 7.79911 7.76636 7.76126C7.81749 7.7234 7.8516 7.66688 7.86125 7.604C7.86609 7.57266 7.86472 7.54067 7.8572 7.50987C7.84968 7.47906 7.83617 7.45004 7.81743 7.42445C7.7987 7.39887 7.77511 7.37723 7.74801 7.36076C7.72091 7.34429 7.69083 7.33333 7.65949 7.32849C7.64278 7.32594 7.36901 7.28705 7.05754 7.42767L6.95131 7.26938C6.93365 7.24303 6.91097 7.22042 6.88457 7.20284C6.85816 7.18525 6.82856 7.17305 6.79743 7.16691C6.76631 7.16078 6.73429 7.16084 6.70319 7.16708C6.67209 7.17333 6.64252 7.18564 6.61619 7.20332C6.58985 7.221 6.56725 7.24369 6.54968 7.2701C6.53212 7.29652 6.51993 7.32613 6.51382 7.35726C6.5077 7.38838 6.50778 7.42041 6.51405 7.4515C6.52031 7.4826 6.53265 7.51216 6.55034 7.53848L6.6662 7.71117C6.64683 7.7318 6.62809 7.75303 6.61003 7.77481C6.39723 8.03329 6.35055 8.39389 6.4883 8.71585C6.61421 9.01026 6.8678 9.20606 7.15013 9.22685C7.29336 9.23738 7.45478 9.22698 7.66004 9.19208L8.36491 10.2425C8.22522 10.3183 8.11284 10.342 7.90191 10.3445C7.8702 10.3449 7.83888 10.3515 7.80974 10.364C7.78059 10.3765 7.75419 10.3946 7.73204 10.4173C7.7099 10.44 7.69244 10.4668 7.68066 10.4962C7.66889 10.5257 7.66303 10.5571 7.66342 10.5888C7.66418 10.6524 7.68994 10.713 7.73512 10.7577C7.7803 10.8023 7.84125 10.8274 7.90477 10.8274H7.90777C8.23678 10.8234 8.42678 10.7648 8.63478 10.6446L8.7538 10.822C8.77588 10.8549 8.80574 10.8819 8.84075 10.9006C8.87576 10.9192 8.91483 10.929 8.95449 10.9289C8.99824 10.9289 9.04116 10.9169 9.07866 10.8944C9.11616 10.8719 9.14683 10.8396 9.1674 10.801C9.18797 10.7623 9.19766 10.7189 9.19543 10.6752C9.19321 10.6315 9.17915 10.5892 9.15477 10.5529L9.02474 10.3591ZM7.18567 8.74531C7.08562 8.73794 6.98617 8.65185 6.93234 8.52598C6.88615 8.418 6.87005 8.26383 6.94831 8.13142L7.35919 8.74367C7.29729 8.74821 7.23879 8.74924 7.18567 8.74531ZM8.18405 9.07654C8.58144 8.97468 8.74495 9.26117 8.78567 9.35141C8.86207 9.52068 8.86777 9.75041 8.74321 9.93948L8.16702 9.08086L8.18405 9.07654Z" fill="#81CDA1"/>
                                        </g>
                                        <defs>
                                        <clipPath id="clip0_661_604">
                                        <rect width="16" height="16" fill="white"/>
                                        </clipPath>
                                        </defs>
                                    </svg>                                                
                                </span>
                                {:else}
                                <span>
                                    0
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <g clip-path="url(#clip0_661_604)">
                                        <path d="M6.85405 15.4348L1.80848 11.496C1.56935 11.3093 1.5274 10.9641 1.71476 10.7252L9.9622 0.210653C10.1493 -0.0278984 10.4944 -0.0701358 10.7331 0.116263L15.7787 4.05513C16.0179 4.24178 16.0598 4.58699 15.8724 4.8259L7.62501 15.3404C7.43787 15.579 7.09286 15.6212 6.85405 15.4348Z" fill="#57AD7B"/>
                                        <path d="M3.66743 15.7569L0.102847 10.4452C-0.0661668 10.1934 0.00137441 9.85213 0.25364 9.68321L11.3646 2.24437C11.6166 2.07568 11.9575 2.1428 12.1263 2.39436L15.6909 7.70601C15.8599 7.95785 15.7924 8.2991 15.5401 8.46802L4.42916 15.9069C4.17718 16.0756 3.83626 16.0084 3.66743 15.7569Z" fill="#81CDA1"/>
                                        <path d="M15.6913 7.70601L12.1267 2.39436C11.9579 2.1428 11.617 2.07568 11.365 2.24437L10.9326 2.53385L14.4036 7.70601C14.5726 7.95785 14.5051 8.2991 14.2528 8.46802L3.57422 15.6174L3.66784 15.7569C3.83666 16.0084 4.17758 16.0756 4.42956 15.9069L15.5405 8.46802C15.7928 8.2991 15.8603 7.95785 15.6913 7.70601Z" fill="#60BF88"/>
                                        <path d="M10.8241 9.25356C10.918 7.63959 9.68426 6.255 8.06847 6.16098C6.45267 6.06697 5.06668 7.29913 4.97277 8.9131C4.87886 10.5271 6.1126 11.9117 7.72839 12.0057C9.34419 12.0997 10.7302 10.8675 10.8241 9.25356Z" fill="#29795D"/>
                                        <path d="M1.77438 8.66541C2.50649 9.75634 2.21469 11.2335 1.12263 11.9646L0.102624 10.4447C-0.0661647 10.1932 0.0015375 9.85234 0.253867 9.68342L1.77438 8.66541ZM2.65045 14.2413C3.74483 13.5086 5.22427 13.7971 5.95482 14.8857L4.43009 15.9066C4.17779 16.0755 3.83642 16.0085 3.66763 15.757L2.65045 14.2413ZM14.0206 9.48721C13.2885 8.39628 13.5803 6.91916 14.6723 6.18802L15.6923 7.70792C15.8611 7.95945 15.7934 8.30028 15.5411 8.46919L14.0206 9.48721ZM13.1445 3.91135C12.0501 4.64407 10.5707 4.35552 9.84012 3.26688L11.3649 2.24606C11.6172 2.07714 11.9585 2.14411 12.1273 2.3956L13.1445 3.91135Z" fill="#29795D"/>
                                        <path d="M11.574 6.85551C11.5222 6.85557 11.4717 6.83897 11.4301 6.80814C11.3884 6.77732 11.3578 6.73392 11.3427 6.68435C11.3276 6.63478 11.3289 6.58167 11.3463 6.53287C11.3638 6.48407 11.3964 6.44217 11.4395 6.41337L12.5761 5.65239C12.6025 5.63475 12.632 5.62247 12.6631 5.61625C12.6942 5.61004 12.7262 5.61001 12.7573 5.61617C12.7885 5.62233 12.818 5.63455 12.8444 5.65215C12.8708 5.66974 12.8935 5.69235 12.9111 5.7187C12.9287 5.74505 12.941 5.77462 12.9472 5.80571C12.9534 5.8368 12.9535 5.86882 12.9473 5.89992C12.9412 5.93103 12.9289 5.96062 12.9113 5.987C12.8937 6.01338 12.8711 6.03603 12.8448 6.05367L11.7081 6.81465C11.6685 6.8413 11.6218 6.85552 11.574 6.85551ZM3.08349 12.54C3.03169 12.54 2.98124 12.5234 2.9396 12.4926C2.89796 12.4618 2.86734 12.4184 2.85226 12.3688C2.83717 12.3193 2.83843 12.2662 2.85585 12.2174C2.87326 12.1686 2.9059 12.1267 2.94896 12.0979L4.08557 11.3369C4.13878 11.3018 4.20373 11.2891 4.26624 11.3017C4.32875 11.3143 4.38374 11.3511 4.41921 11.4041C4.45469 11.4571 4.46776 11.5219 4.45559 11.5845C4.44341 11.6471 4.40697 11.7023 4.35422 11.7381L3.21761 12.4991C3.17796 12.5258 3.13127 12.54 3.08349 12.54Z" fill="#29795D"/>
                                        <path d="M9.02474 10.3591C9.37288 10.0003 9.38421 9.50388 9.22582 9.15278C9.01894 8.69435 8.56299 8.48078 8.06406 8.60878C8.00406 8.62417 7.94253 8.63949 7.88059 8.65407L7.33283 7.83785C7.47042 7.79316 7.57766 7.80482 7.58825 7.8061C7.65121 7.81523 7.71523 7.79911 7.76636 7.76126C7.81749 7.7234 7.8516 7.66688 7.86125 7.604C7.86609 7.57266 7.86472 7.54067 7.8572 7.50987C7.84968 7.47906 7.83617 7.45004 7.81743 7.42445C7.7987 7.39887 7.77511 7.37723 7.74801 7.36076C7.72091 7.34429 7.69083 7.33333 7.65949 7.32849C7.64278 7.32594 7.36901 7.28705 7.05754 7.42767L6.95131 7.26938C6.93365 7.24303 6.91097 7.22042 6.88457 7.20284C6.85816 7.18525 6.82856 7.17305 6.79743 7.16691C6.76631 7.16078 6.73429 7.16084 6.70319 7.16708C6.67209 7.17333 6.64252 7.18564 6.61619 7.20332C6.58985 7.221 6.56725 7.24369 6.54968 7.2701C6.53212 7.29652 6.51993 7.32613 6.51382 7.35726C6.5077 7.38838 6.50778 7.42041 6.51405 7.4515C6.52031 7.4826 6.53265 7.51216 6.55034 7.53848L6.6662 7.71117C6.64683 7.7318 6.62809 7.75303 6.61003 7.77481C6.39723 8.03329 6.35055 8.39389 6.4883 8.71585C6.61421 9.01026 6.8678 9.20606 7.15013 9.22685C7.29336 9.23738 7.45478 9.22698 7.66004 9.19208L8.36491 10.2425C8.22522 10.3183 8.11284 10.342 7.90191 10.3445C7.8702 10.3449 7.83888 10.3515 7.80974 10.364C7.78059 10.3765 7.75419 10.3946 7.73204 10.4173C7.7099 10.44 7.69244 10.4668 7.68066 10.4962C7.66889 10.5257 7.66303 10.5571 7.66342 10.5888C7.66418 10.6524 7.68994 10.713 7.73512 10.7577C7.7803 10.8023 7.84125 10.8274 7.90477 10.8274H7.90777C8.23678 10.8234 8.42678 10.7648 8.63478 10.6446L8.7538 10.822C8.77588 10.8549 8.80574 10.8819 8.84075 10.9006C8.87576 10.9192 8.91483 10.929 8.95449 10.9289C8.99824 10.9289 9.04116 10.9169 9.07866 10.8944C9.11616 10.8719 9.14683 10.8396 9.1674 10.801C9.18797 10.7623 9.19766 10.7189 9.19543 10.6752C9.19321 10.6315 9.17915 10.5892 9.15477 10.5529L9.02474 10.3591ZM7.18567 8.74531C7.08562 8.73794 6.98617 8.65185 6.93234 8.52598C6.88615 8.418 6.87005 8.26383 6.94831 8.13142L7.35919 8.74367C7.29729 8.74821 7.23879 8.74924 7.18567 8.74531ZM8.18405 9.07654C8.58144 8.97468 8.74495 9.26117 8.78567 9.35141C8.86207 9.52068 8.86777 9.75041 8.74321 9.93948L8.16702 9.08086L8.18405 9.07654Z" fill="#81CDA1"/>
                                        </g>
                                        <defs>
                                        <clipPath id="clip0_661_604">
                                        <rect width="16" height="16" fill="white"/>
                                        </clipPath>
                                        </defs>
                                    </svg>                                                
                                </span>
                            {/if}
                        </b></p>
                    </div>
                {/if}
            </div>
            <div class="questdesc">
                <div class="questdescleft">
                    <h1>Описание:</h1>
                    <p>{quest.Desc}</p>
                </div>
                <div class="questdescright">
                    <svg width="67" height="67" viewBox="0 0 67 67" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M43.1836 19.6289C40.6581 19.6289 38.6035 17.5743 38.6035 15.0488V0H15.1797C11.2111 0 7.98242 3.22869 7.98242 7.19727V59.8027C7.98242 63.7713 11.2111 67 15.1797 67H51.8203C55.7889 67 59.0176 63.7713 59.0176 59.8027V19.6289H43.1836ZM18.7129 47.1094H28.229C29.313 47.1094 30.1919 47.9882 30.1919 49.0723C30.1919 50.1563 29.313 51.0352 28.229 51.0352H18.7129C17.6289 51.0352 16.75 50.1563 16.75 49.0723C16.75 47.9882 17.6289 47.1094 18.7129 47.1094ZM16.75 38.6035C16.75 37.5195 17.6289 36.6406 18.7129 36.6406H47.502C48.586 36.6406 49.4648 37.5195 49.4648 38.6035C49.4648 39.6876 48.586 40.5664 47.502 40.5664H18.7129C17.6289 40.5664 16.75 39.6876 16.75 38.6035ZM47.502 26.1719C48.586 26.1719 49.4648 27.0507 49.4648 28.1348C49.4648 29.2188 48.586 30.0977 47.502 30.0977H18.7129C17.6289 30.0977 16.75 29.2188 16.75 28.1348C16.75 27.0507 17.6289 26.1719 18.7129 26.1719H47.502Z" fill="white" fill-opacity="0.08"/>
                        <path d="M42.5293 15.0487C42.5293 15.4095 42.8228 15.703 43.1836 15.703H58.1427C57.7819 15.035 57.3174 14.4285 56.7667 13.9061L44.1488 1.9688C43.6649 1.51094 43.1199 1.12231 42.5294 0.813965V15.0487H42.5293Z" fill="white" fill-opacity="0.08"/>
                    </svg>                                        
                </div>
            </div>
            {#if quest.Tasks}
                <div class="questmisson">
                    <div class="questmissonleft">
                        <h1>Цели:</h1>
                        {#each quest.Tasks as task, index}
                            <p class:done={!(index >= quest.Stage)} class:undone={index >= quest.Stage}>
                                <svg class="undone" width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <rect width="21" height="21" rx="2" fill="white" fill-opacity="0.19"/>
                                </svg>
                                <svg class="done" width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <rect width="21" height="21" rx="2" fill="#E81C5B"/>
                                    <path d="M8.28372 15C7.99225 14.9999 7.71274 14.8948 7.50667 14.7078L5.30852 12.7132C5.10832 12.5251 4.99754 12.2732 5.00004 12.0117C5.00255 11.7502 5.11813 11.5001 5.32191 11.3152C5.52569 11.1303 5.80135 11.0254 6.08952 11.0231C6.3777 11.0209 6.65533 11.1214 6.86261 11.303L8.22162 12.5362L14.0434 6.37347C14.1356 6.26918 14.2499 6.18276 14.3796 6.11935C14.5092 6.05594 14.6517 6.01683 14.7983 6.00436C14.945 5.99188 15.0929 6.00628 15.2333 6.04671C15.3738 6.08714 15.5038 6.15277 15.6157 6.2397C15.7276 6.32663 15.8191 6.43309 15.8848 6.55275C15.9504 6.67241 15.9889 6.80282 15.9979 6.93624C16.007 7.06966 15.9863 7.20337 15.9373 7.32941C15.8882 7.45545 15.8117 7.57125 15.7124 7.66994L9.11791 14.6509C9.01567 14.7612 8.88792 14.8496 8.74374 14.9099C8.59955 14.9702 8.44249 15.001 8.28372 15Z" fill="white"/>
                                </svg>                                
                                {task}
                            </p>
                        {/each}
                    </div>
                    <div class="questmissonright">
                        <svg width="67" height="67" viewBox="0 0 67 67" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g clip-path="url(#clip0_661_584)">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M10.8426 50.7305L0 32.1791L9.37071 26.703L20.2112 45.255L10.8426 50.7305ZM66.7361 19.9045C67.0056 19.365 67.0722 18.7465 66.9237 18.1619C66.7751 17.5774 66.4213 17.0657 65.9269 16.7203C65.4324 16.3749 64.8303 16.2188 64.2303 16.2805C63.6304 16.3422 63.0726 16.6176 62.6587 17.0563C62.6298 17.088 62.5981 17.117 62.5639 17.143L49.5617 27.2046C49.1503 27.9566 48.5443 28.5842 47.8072 29.0216C47.07 29.459 46.2288 29.6902 45.3717 29.6909H33.5238C33.3043 29.6909 33.0938 29.6037 32.9386 29.4485C32.7833 29.2933 32.6961 29.0828 32.6961 28.8633C32.6961 28.6437 32.7833 28.4332 32.9386 28.278C33.0938 28.1228 33.3043 28.0356 33.5238 28.0356H45.3717C46.1961 28.0302 46.985 27.699 47.566 27.1141C48.1471 26.5293 48.4733 25.7383 48.4733 24.9139C48.4733 24.0894 48.1471 23.2984 47.566 22.7136C46.985 22.1287 46.1961 21.7975 45.3717 21.7921H34.5045C34.3327 21.7924 34.1651 21.7392 34.0249 21.6399C31.7977 20.0596 29.135 19.2094 26.4041 19.2067C23.6732 19.204 21.0087 20.049 18.7785 21.6249L11.6644 27.3496L20.2197 41.987L21.65 40.899C22.6365 40.1304 23.8514 39.7133 25.102 39.7141L48.4211 39.4591C49.0216 39.4637 49.6153 39.3328 50.1582 39.0761C50.701 38.8193 51.1788 38.4433 51.5561 37.9762L66.7358 19.9045H66.7361ZM11.7925 48.3828C12.2041 48.383 12.6065 48.2611 12.9488 48.0326C13.2911 47.8041 13.5579 47.4792 13.7156 47.0991C13.8732 46.7189 13.9145 46.3005 13.8344 45.8968C13.7542 45.4931 13.5561 45.1223 13.2652 44.8312C12.9742 44.5401 12.6035 44.3419 12.1999 44.2615C11.7962 44.1811 11.3778 44.2223 10.9976 44.3797C10.6173 44.5372 10.2923 44.8039 10.0636 45.146C9.83496 45.4882 9.71291 45.8905 9.71291 46.3021C9.7137 46.8535 9.93303 47.3821 10.3228 47.7721C10.7126 48.1621 11.2411 48.3817 11.7925 48.3828ZM11.7925 45.875C11.7081 45.8749 11.6256 45.8998 11.5555 45.9467C11.4853 45.9935 11.4305 46.06 11.3982 46.138C11.3658 46.2159 11.3573 46.3017 11.3736 46.3844C11.39 46.4672 11.4306 46.5432 11.4902 46.603C11.5498 46.6627 11.6258 46.7034 11.7085 46.7199C11.7913 46.7364 11.877 46.7281 11.955 46.6959C12.033 46.6636 12.0997 46.609 12.1466 46.5389C12.1936 46.4688 12.2187 46.3863 12.2187 46.302C12.2189 46.2459 12.2079 46.1904 12.1866 46.1386C12.1652 46.0868 12.1338 46.0397 12.0943 46C12.0547 45.9603 12.0076 45.9289 11.9558 45.9074C11.9041 45.886 11.8486 45.8749 11.7925 45.875Z" fill="white" fill-opacity="0.08"/>
                            </g>
                            <defs>
                            <clipPath id="clip0_661_584">
                            <rect width="67" height="67" fill="white"/>
                            </clipPath>
                            </defs>
                        </svg>                                                                               
                    </div>
                </div>
            {/if}
            {#if quest.Reward}
                {#if quest.Reward.Items}
                    <div class="questrewrad">
                        <h1>Предметы в награду:</h1>
                        <div class="rewardlist">
                            {#each new Array(4) as _, index}
                                {#if quest.Reward.Items[index] && window.getItem (quest.Reward.Items[index])}
                                    <div class="rewardblock">
                                        <img src="{document.cloud}/inventoryItems/items/{quest.Reward.Items[index]}.png" alt=""/>
                                    </div>
                                {:else}
                                    <div class="rewardblock"></div>
                                {/if}
                            {/each}
                        </div>
                    </div>
                {/if}
            {/if}
            <div class="questbtns">
                <div class="btnquest" on:keypress={() => {}} on:click={onRoute}>Построить маршурт</div>
                <div class="btnquest" on:keypress={() => {}} on:click={onSelect}>Взять кест</div>  
            </div>
        </div>
    </div>
    {:else}
    <div class="questmenu">
        <div class="questleft">
        </div>
        <div class="questright">
        </div>
    </div>
{/if}